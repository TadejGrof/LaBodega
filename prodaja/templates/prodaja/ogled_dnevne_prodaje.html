{% extends 'program/base.html' %}

{% load zaloga_exstras %}

{% block content %}

<style>
    div.title{
        display:block;
        height:10%;
        margin-top:3%;
        text-align:center;
        font-size:6vh
    }
    div.sub_title{
        display:block;
        height:10%;
        margin-top:2%;
        text-align:center;
        font-size:4vh
    }
    div.racuni{
        display:inline-block;
        width:45%;
        height:60%;
        margin-top:3%;
        vertical-align:top;
        margin-left:1.5%;
        border: 1px solid black
    }
    div.racun{
        display:inline-block;
        width:45%;
        height:60%;
        margin-top:3%;
        vertical-align:top;
        margin-left:3%;
        border: 1px solid black
    }
</style>

<h1 style="margin-top:3%">
    {{slovar|keyvalue:'Ogled prodaje na dan'|keyvalue:jezik}} {{prodaja.title}}
</h1>

<div class="racuni">
    <h2 style="margin-top:2%">
        {{slovar|keyvalue:'Racuni'|keyvalue:jezik}}:
    </h2>
    <div style="display:inline-block;width:90%;height:60%;overflow:auto" >
        <table style="width:100%" class="tabela_vnosov">
            <tr class="header">
                <th> St.: </th>
                <th> Status: </th>
                <th> Cas: </th>
                <th> Cena: </th>
                <th> Vpogled: </th>
            </tr>
            {% for racun in racuni %}
            <tr>
                <td> {{racun.title}} </td>
                <td> {{racun.status}} </td>
                <td> {{racun.cas}} </td>
                <td> {{racun.koncna_cena}}$ </td>
                <td> 
                    <form action="{% url 'ogled_dnevne_prodaje' zaloga.pk prodaja.pk %}" method="GET">
                        <input type="number" hidden="hidden" name="pk" value={{prodaja.pk}}>
                        <input type="number" hidden="hidden" name="racun_pk" value={{racun.pk}}>
                        <input type="submit" value="vpogled">
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div style="display:inline-block;width:90%">
        <table  class="tabela_vnosov">
            <tr>
                <td> {{slovar|keyvalue:'Stevilo prodanih'|keyvalue:jezik}}: </td>
                <td> {{prodaja.skupno_stevilo}} </td>
                <td> {{slovar|keyvalue:'Skupna cena'|keyvalue:jezik}}: </td>
                <td> {{prodaja.skupna_cena}}$ </td>
            </tr>
        </table>
    </div>
</div>

<div class="racun">
    {% if racun == None %}
        <h1> {{slovar|keyvalue:'Brez veljavnih racunov'|keyvalue:jezik}} </h1>
    {% else %}
        <h2> {{slovar|keyvalue:'Racun'|keyvalue:jezik}} {{racun.title}} </h2>
        <div style="display:inline-block;width:80%;height:46%;overflow:auto">
            <table style="width:100%" class="tabela_vnosov">
                <tr class="header">
                    <th> {{slovar|keyvalue:'Dimenzija'|keyvalue:jezik}}: </th>
                    <th> {{slovar|keyvalue:'Tip'|keyvalue:jezik}}: </th>
                    <th> N.: </th>
                    <th> {{slovar|keyvalue:'Cena'|keyvalue:jezik}}: </th>
                    <th> {{slovar|keyvalue:'Skupaj'|keyvalue:jezik}}: </th>
                </tr>
                {% for vnos in racun.vrni_vnose %}
                <tr>
                    <td> {{vnos.dimenzija}} </td>
                    <td> {{vnos.tip}} </td>
                    <td> {{vnos.stevilo}} </td>
                    <td> {{vnos.cena}}$ </td>
                    <td> {{vnos.skupna_cena}}$ </td>
                </tr>
                {% endfor %}
                <tr>
                    <td> {{slovar|keyvalue:'Skupno'|keyvalue:jezik}}: </td>
                    <td> {{slovar|keyvalue:'Stevilo'|keyvalue:jezik}}:</td>
                    <td> {{racun.skupno_stevilo}} </td>
                    <td> {{slovar|keyvalue:'Cena'|keyvalue:jezik}}: </td>
                    <td> {{racun.skupna_cena }}$ </td>
                </tr>
            </table>
        </div>
        <div style="display:inline-block;width:80%">
            <table class="tabela_vnosov">
                <tr>
                    <td> {{slovar|keyvalue:'Skupna cena'|keyvalue:jezik}}: </td>
                    <td> {{racun.koncna_cena}}$ </td>
                </tr>
            </table>
        </div>
        {% if racun.status == "veljavno" %}
            <div style="margin-top:4%">
                <form action="{% url 'storniraj_racun' zaloga.pk prodaja.pk racun.pk %}" method="POST" onsubmit="return Confirm()">
                    {% csrf_token %}
                    <input type="submit" value="STORNO">
                </form>
            </div>
        {% endif %}
    {% endif %}
</div>

<div class="sestavine">
    <h2>
        {{slovar|keyvalue:'Prodane'|keyvalue:jezik}}:
        <form style="display:inline-block;width:10%;margin-left:1%;" action="{% url 'pdf_dnevne_prodaje' zaloga.pk prodaja.pk 'prodane' %}" method="GET">
            <input type="submit" value="PDF" style="width:100%">
        </form>
    </h2>
    <div style="display:inline-block;width:80%;margin-bottom:3%">
        <table  class="tabela_vnosov">
            <tr class="header">
                <th>{{slovar|keyvalue:'Dimenzija'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Tip'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Stevilo'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Cena'|keyvalue:jezik}}:</th>
            </tr>
            {% with prodaja.prodane as prodane %}
                {% for prodana in prodane %}
                    <tr>
                        <td> {{prodane|keyvalue:prodana|keyvalue:'dimenzija'}} </td>
                        <td> {{prodane|keyvalue:prodana|keyvalue:'tip'}} </td>
                        <td> {{prodane|keyvalue:prodana|keyvalue:'stevilo'}} </td>
                        <td> {{prodane|keyvalue:prodana|keyvalue:'cena'}} $ </td>
                    </tr>
                {% endfor %}
            {% endwith %}
        </table>
    </div>
</div>

<div class="sestavine">
    <h2>
        Activity_log:
        <form style="display:inline-block;width:10%;margin-left:1%;" action="{% url 'pdf_dnevne_prodaje' zaloga.pk prodaja.pk 'activity_log' %}" method="GET">
            <input type="submit" value="PDF" style="width:100%">
        </form>
    </h2>
    <div style="display:inline-block;width:80%;margin-bottom:3%">
        <table  class="tabela_vnosov">
            <tr class="header">
                <th>{{slovar|keyvalue:'Cas'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Dimenzija'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Tip'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Stevilo'|keyvalue:jezik}}:</th>
                <th>{{slovar|keyvalue:'Cena'|keyvalue:jezik}}:</th>
            </tr>
            {% with prodaja.activity_log as prodane %}
                {% for prodana in prodane %}
                    <tr>
                        <td> {{prodana.cas}} </td>
                        <td> {{prodana.dimenzija}} </td>
                        <td> {{prodana.tip}} </td>
                        <td> {{prodana.stevilo}} </td>
                        <td> {{prodana.cena}} $ </td>
                    </tr>
                {% endfor %}
            {% endwith %}
        </table>
    </div>
</div>
<script>
    function Confirm() {
        if (!confirm('are you sure?')){
            return false
        }
    }
</script>
{% endblock %}