{% load zaloga_exstras %}

<style>
    input.input{
        text-align:center;
        width:60%
    }
</style>

<div class="vnosi inline" style="width:80%;margin:2%">
    <table id="tabela_vnosov" class="tabela_vnosov">
        <tr class="header">
            <th class="index"> N. </th>
            <th class="dimenzija"> {{slovar|keyvalue:'Dimenzija'|keyvalue:jezik}}: </th>
            <th class="tip"> {{slovar|keyvalue:'Tip'|keyvalue:jezik}}: </th>
            <th class="stevilo"> {{slovar|keyvalue:'Stevilo'|keyvalue:jezik}}: </th>
            <th class="skrit cena"> {{slovar|keyvalue:'Cena'|keyvalue:jezik}}: </th>
            <th class="skrit skupnaCena"> {{slovar|keyvalue:'Skupaj'|keyvalue:jezik}}: </th>
            <th class="uredi"> {{slovar|keyvalue:'Uredi'|keyvalue:jezik}}: </th>  
        </tr>
        {% for vnos in vnosi %}
            {% include 'baza/tabela_vnosov_row.html' with index=forloop.counter %}
        {% endfor %}
        {% include './tabela_vnosov_row.html' %}
        {% include "./tabela_vnosov_skupno_row.html" %}; 
        {% if tip == "vele_prodaja" %}
            {% include "./tabela_vnosov_vele_prodaja.html" %}
        {% elif tip == "prevzem" %}
            {% include "./tabela_vnosov_prevzem.html" %}
        {% endif %}
    </table>
</div>

<script>
    if(baza["status"] == "zaklenjeno"){
        $("#tabela_vnosov .edit").toggleClass("skrit");
    }
    if(baza["status"] == "vele_prodaja"){
        $("#tabela_vnosov .cena, .skupnaCena").toggleClass("skrit");
    }

    $("#tabela_vnosov .show_spremeni_vnos_button").click(function(){
        $(".sprememba",this.parentElement.parentElement.parentElement).toggleClass("skrit");
    });

    $("#tabela_vnosov .spremeni_vnos_button").click(function(){
        var vrstica = this.parentElement.parentElement.parentElement
        var vnos = vrstica.getAttribute("data-vnos");
        var stevilo = $("input.stevilo",vrstica).val();
        if(stevilo == "" || stevilo <= 0){return;}
        var cena = $("input.cena",vrstica).val();
        spremeniVnos(vnos,stevilo,cena);
        $(".sprememba",vrstica).toggleClass("skrit");
    });

    $("#tabela_vnosov .izbrisi_vnos_button").click(function(){
        var vrstica = this.parentElement.parentElement.parentElement;
        var vnos = vrstica.getAttribute("data-vnos");
        izbrisiVnos(vnos);
    });

    function odstraniVrstico(vnos){
        $('#tabela_vnosov tr[data-vnos=' + vnos["id"] + ']').remove();
    }
    
    function vstaviVrstico(vnos){
        var prazna_vrstica = document.getElementById("empty_row");
        var nova_vrstica = prazna_vrstica.cloneNode(true);
        nova_vrstica.setAttribute("data-vnos",vnos["id"]);
        nova_vrstica.classList.remove("skrit");
        nova_vrstica.classList.add("vnos_row");
        $("#tabela_vnosov tr:nth-child(" + vnos["index"] + ")").after(nova_vrstica);
        refreshVrstica(vnos);
    }

    function refreshTabelaVnosov(){
        var i = 0
        $('#tabela_vnosov tr.vnos_row').each(function(){
            i++;
            $("td.index",this).html(i + ".");
        })
    }

    function refreshVrstica(vnos){
        var vrstica = $("#tabela_vnosov tr[data-vnos=" + vnos["id"] + "]");
        $("td.dimenzija",vrstica).html(vnos["dimenzija"]);
        $("td.tip",vrstica).html(vnos["tip"]);
        $("div.stevilo",vrstica).html(vnos["stevilo"]);
        $("div.cena",vrstica).html(vnos["cena"]);
        $("td.skupna_cena",vrstica).html(vnos["skupna_cena"]);
    }

</script>